"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/common/http");
var md5_1 = require("ts-md5/dist/md5");
require("rxjs/add/operator/map");
var QuadrinhoService = /** @class */ (function () {
    function QuadrinhoService(http) {
        this.http = http;
        this.PUBLIC_KEY = "dc005bd4fe7429cdfccbcfc756e79b7f";
        this.PRIVATE_KEY = "ec38d937988d5aedbea7b427414388679ec4d6da";
        this.BASE_URL = "https://gateway.marvel.com:443/v1/public";
    }
    QuadrinhoService.prototype.obterQuadrinhos = function (titulo, limit, offset) {
        if (titulo === void 0) { titulo = undefined; }
        if (limit === void 0) { limit = 20; }
        if (offset === void 0) { offset = 0; }
        var timestamp = Date.now();
        var hash = md5_1.Md5.hashStr(timestamp + this.PRIVATE_KEY + this.PUBLIC_KEY).toString();
        var params = new http_1.HttpParams()
            .set('limit', String(limit))
            .set('offset', String(offset))
            .set('ts', String(timestamp))
            .set('hash', String(hash))
            .set('apikey', String(this.PUBLIC_KEY));
        if (titulo) {
            params.set('titleStartsWith', titulo);
        }
        return this.http.get(this.BASE_URL + "/comics", { params: params });
    };
    QuadrinhoService.prototype.obterQuadrinho = function (codigo) {
        var timestamp = Date.now();
        var hash = md5_1.Md5.hashStr(timestamp + this.PRIVATE_KEY + this.PUBLIC_KEY).toString();
        return this.http.get(this.BASE_URL + "/comics/" + codigo + "&ts=" + timestamp + "&hash=" + hash + "&apikey=" + this.PUBLIC_KEY).map(function (result) {
            return result.data.count > 0 ? result.data.results[0] : undefined;
        });
    };
    QuadrinhoService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [http_1.HttpClient])
    ], QuadrinhoService);
    return QuadrinhoService;
}());
exports.QuadrinhoService = QuadrinhoService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVhZHJpbmhvLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJxdWFkcmluaG8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUEyQztBQUMzQyw2Q0FBOEQ7QUFFOUQsdUNBQXFDO0FBR3JDLGlDQUErQjtBQUcvQjtJQU1FLDBCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBSjVCLGVBQVUsR0FBVyxrQ0FBa0MsQ0FBQztRQUN4RCxnQkFBVyxHQUFXLDBDQUEwQyxDQUFDO1FBQ2pFLGFBQVEsR0FBVywwQ0FBMEMsQ0FBQTtJQUU3QixDQUFDO0lBRXpDLDBDQUFlLEdBQWYsVUFBZ0IsTUFBMEIsRUFBRSxLQUFpQixFQUFFLE1BQWtCO1FBQWpFLHVCQUFBLEVBQUEsa0JBQTBCO1FBQUUsc0JBQUEsRUFBQSxVQUFpQjtRQUFFLHVCQUFBLEVBQUEsVUFBa0I7UUFDL0UsSUFBTSxTQUFTLEdBQVcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3JDLElBQU0sSUFBSSxHQUFXLFNBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzVGLElBQUksTUFBTSxHQUFHLElBQUksaUJBQVUsRUFBRTthQUN4QixHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMzQixHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUM3QixHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQzthQUM1QixHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QixHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUU1QyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUN6QyxDQUFDO1FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFlLElBQUksQ0FBQyxRQUFRLFlBQVMsRUFBRSxFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFQyx5Q0FBYyxHQUFkLFVBQWUsTUFBYztRQUMzQixJQUFNLFNBQVMsR0FBVyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDckMsSUFBTSxJQUFJLEdBQVcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUYsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFlLElBQUksQ0FBQyxRQUFRLGdCQUFXLE1BQU0sWUFBTyxTQUFTLGNBQVMsSUFBSSxnQkFBVyxJQUFJLENBQUMsVUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsTUFBTTtZQUNsSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQS9CWSxnQkFBZ0I7UUFENUIsaUJBQVUsRUFBRTt5Q0FPZSxpQkFBVTtPQU56QixnQkFBZ0IsQ0FrQzVCO0lBQUQsdUJBQUM7Q0FBQSxBQWxDRCxJQWtDQztBQWxDWSw0Q0FBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBNZDUgfSBmcm9tICd0cy1tZDUvZGlzdC9tZDUnXG5pbXBvcnQgeyBDb21pY0RhdGEgfSBmcm9tICcuLi9tb2RlbC9tYXJ2ZWwnO1xuaW1wb3J0IHsgQ29taWMgfSBmcm9tICcuLi9tb2RlbC9tYXJ2ZWwvJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFF1YWRyaW5ob1NlcnZpY2Uge1xuXG4gIHByaXZhdGUgUFVCTElDX0tFWTogc3RyaW5nID0gXCJkYzAwNWJkNGZlNzQyOWNkZmNjYmNmYzc1NmU3OWI3ZlwiO1xuICBwcml2YXRlIFBSSVZBVEVfS0VZOiBzdHJpbmcgPSBcImVjMzhkOTM3OTg4ZDVhZWRiZWE3YjQyNzQxNDM4ODY3OWVjNGQ2ZGFcIjtcbiAgcHJpdmF0ZSBCQVNFX1VSTDogc3RyaW5nID0gXCJodHRwczovL2dhdGV3YXkubWFydmVsLmNvbTo0NDMvdjEvcHVibGljXCJcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxuXG4gIG9idGVyUXVhZHJpbmhvcyh0aXR1bG86IHN0cmluZyA9IHVuZGVmaW5lZCwgbGltaXQ6bnVtYmVyID0gMjAsIG9mZnNldDogbnVtYmVyID0gMCk6IE9ic2VydmFibGU8Q29taWNEYXRhPiB7XG4gICAgY29uc3QgdGltZXN0YW1wOiBudW1iZXIgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGhhc2g6IHN0cmluZyA9IE1kNS5oYXNoU3RyKHRpbWVzdGFtcCArIHRoaXMuUFJJVkFURV9LRVkgKyB0aGlzLlBVQkxJQ19LRVkpLnRvU3RyaW5nKCk7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKClcbiAgICAgICAgLnNldCgnbGltaXQnLCBTdHJpbmcobGltaXQpKVxuICAgICAgICAuc2V0KCdvZmZzZXQnLCBTdHJpbmcob2Zmc2V0KSlcbiAgICAgICAgLnNldCgndHMnLCBTdHJpbmcodGltZXN0YW1wKSlcbiAgICAgICAgLnNldCgnaGFzaCcsIFN0cmluZyhoYXNoKSlcbiAgICAgICAgLnNldCgnYXBpa2V5JywgU3RyaW5nKHRoaXMuUFVCTElDX0tFWSkpO1xuXG4gICAgaWYgKHRpdHVsbykge1xuICAgICAgICBwYXJhbXMuc2V0KCd0aXRsZVN0YXJ0c1dpdGgnLCB0aXR1bG8pXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8Q29taWNEYXRhPihgJHt0aGlzLkJBU0VfVVJMfS9jb21pY3NgLCB7cGFyYW1zOiBwYXJhbXN9KTtcbn1cblxuICBvYnRlclF1YWRyaW5obyhjb2RpZ286IG51bWJlcik6IE9ic2VydmFibGU8Q29taWM+IHtcbiAgICBjb25zdCB0aW1lc3RhbXA6IG51bWJlciA9IERhdGUubm93KCk7XG4gICAgY29uc3QgaGFzaDogc3RyaW5nID0gTWQ1Lmhhc2hTdHIodGltZXN0YW1wICsgdGhpcy5QUklWQVRFX0tFWSArIHRoaXMuUFVCTElDX0tFWSkudG9TdHJpbmcoKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxDb21pY0RhdGE+KGAke3RoaXMuQkFTRV9VUkx9L2NvbWljcy8ke2NvZGlnb30mdHM9JHt0aW1lc3RhbXB9Jmhhc2g9JHtoYXNofSZhcGlrZXk9JHt0aGlzLlBVQkxJQ19LRVl9YCkubWFwKHJlc3VsdCA9PiB7XG4gICAgICAgIHJldHVybiByZXN1bHQuZGF0YS5jb3VudCA+IDAgPyByZXN1bHQuZGF0YS5yZXN1bHRzWzBdIDogdW5kZWZpbmVkO1xuICAgIH0pO1xufVxuXG5cbn0gIl19